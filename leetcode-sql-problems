262-Hard. Trips and Users
Calculate cancelation rate of a taxi trips by day


        # Filter out UnbannedUser
        With UnbannedUser as (
            SELECT * 
            FROM Users
            WHERE Banned = 'No'
        ),
        # Filter out Trips with unbanned client and driver
            UnbannedTrip as ( 
            SELECT *, SUM(CASE WHEN UnbannedTrip.Status = 'completed' THEN 0 ELSE 1 END) AS 'cancelled',
            COUNT(*) AS 'totalOrder'
            FROM Trips
            WHERE Client_Id IN (SELECT Users_Id FROM UnbannedUser WHERE Role = 'client')
                  AND  Driver_Id IN (SELECT Users_Id FROM UnbannedUser WHERE Role = 'driver' )
            GROUP BY Request_at 
        )

        # Calculate Cancelation Rate by Date

        SELECT DISTINCT Request_at AS 'Day', 
               ROUND(cancelled / totalOrder, 2) AS 'Cancellation Rate'
        FROM UnbannedTrip   
        WHERE Request_at between '2013-10-01' and '2013-10-03'


569. Median Employee Salary
The Employee table holds all employees. The employee table has three columns: Employee Id, Company Name, and Salary.
        SELECT
            Employee.Id, Employee.Company, Employee.Salary
        FROM
            Employee,
            Employee alias
        WHERE
            Employee.Company = alias.Company
        GROUP BY Employee.Company , Employee.Salary
        HAVING SUM(CASE
            WHEN Employee.Salary = alias.Salary THEN 1
            ELSE 0
        END) >= ABS(SUM(SIGN(Employee.Salary - alias.Salary)))  #SIGN(a-b) a-b > 0 return 1, a-b = 0 return 0, a-b < 0 return -1.
        ORDER BY Employee.Id
        ;
